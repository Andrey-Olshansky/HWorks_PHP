<?php
    /*Домашнее задание к занятию «5_Основы работы с объектами»
    http://localhost/HWorks_PHP/Hw_5_Date.php 
    для консоли
    1. cd C:\localhost\HWorks_PHP 
    2. php Hw_5_Date.php
    */
?>
<?php
/*
Вариант от 04.12.2025.

Задание 2: генератор расписания
В этой задаче надо сгенерировать расписание выхода на работу сотрудника, 
который работает сутки через двое, на месяц, с первого числа. Причём если 
рабочий день выпадает на выходные, то переносим его на понедельник, и потом 
опять два выходных, один рабочий и т. д.
Предполагаем, что первое число месяца — это первый рабочий день.
Код ничего не должен принимать в виде входящих параметров.

В виде результата работы на экране необходимо отобразить:
-название месяца,
-список всех дней месяца,
-в списке всех дней выделить рабочие дни этого сотрудника.

Расчёт оформить в виде функции, на вход которой передаётся номер года 
для расчёта и номер месяца.
Выделить рабочие дни можно, например, знаком (+) возле дня, или можно выделить 
дату цветом при помощи таких управляющих символов:

echo "\033[31m красный \033[0m";
echo "\033[32m зелёный \033[0m";

Узнать количество дней в месяце можно при помощи функций
cal_days_in_month(CAL_GREGORIAN, date('m'), date('Y'));
// или
date('t');
Дополнительно
В виде входящих аргументов скрипта разрешить передавать:
-номер года и месяца, с которых начинать расчёт;
-количество месяцев, для которых производить сквозной расчёт графика.

То есть первое число переданного месяца должно быть рабочим днём, но первое 
число второго и последующих месяцев может быть как рабочим, так и выходным 
в зависимости от расчёта в предыдущий месяц.
*/
function generateSchedule($year, $month) {
    $daysInMonth = date('t', mktime(0, 0, 0, $month, 1, $year));
    $monthName = date('F', mktime(0, 0, 0, $month, 1, $year));
    
    echo "Месяц: $monthName $year\n";
    
    $workDays = [];
    $nextWorkDay = 1; // 1 число - первый рабочий
    
    while ($nextWorkDay <= $daysInMonth) {
        // Определяем день недели
        $weekDay = date('w', mktime(0, 0, 0, $month, $nextWorkDay, $year));
        
        // Если выходные - переносим на понедельник
        if ($weekDay == 0 || $weekDay == 6) {
            // Ищем следующий понедельник
            $nextWorkDay += (8 - $weekDay) % 7;
            if ($nextWorkDay > $daysInMonth) break;
            
            // Пересчитываем день недели после переноса
            $weekDay = 1; // Понедельник
        }
        
        // Отмечаем рабочий день
        $workDays[$nextWorkDay] = true;
        
        // Пропускаем 2 выходных
        $nextWorkDay += 3;
    }
    
    // Вывод всех дней месяца
    for ($day = 1; $day <= $daysInMonth; $day++) {
        if (isset($workDays[$day])) {
            echo "\033[32m" . sprintf("%2d (+)", $day) . "\033[0m ";
        } else {
            echo sprintf("%2d", $day) . "    ";
        }
        
        if ($day % 7 == 0) echo "\n";
    }
    
    echo "\n\n";
    return $workDays;
}

// Основной вызов
$currentYear = date('Y');
$currentMonth = date('n');

if (isset($argv[1]) && isset($argv[2])) {
    $year = (int)$argv[1];
    $month = (int)$argv[2];
    $months = isset($argv[3]) ? (int)$argv[3] : 1;
} else {
    $year = $currentYear;
    $month = $currentMonth;
    $months = 1;
}

// Вывод для одного или нескольких месяцев
for ($i = 0; $i < $months; $i++) {
    $currentMonth = $month + $i;
    $currentYear = $year;
    
    // Корректировка при переходе через декабрь
    if ($currentMonth > 12) {
        $currentMonth -= 12;
        $currentYear++;
    }
    
    generateSchedule($currentYear, $currentMonth);
}

?>